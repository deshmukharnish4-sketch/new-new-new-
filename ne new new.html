<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VISION PRO ULTRA - PEAK PERFORMANCE</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Inter', sans-serif; }
        canvas { position: absolute; top: 0; left: 0; z-index: 1; }
        #gui {
            position: absolute; top: 20px; left: 20px; z-index: 10;
            padding: 25px; border-radius: 24px; background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(40px); border: 1px solid rgba(255,255,255,0.1);
            color: #00f2ff; width: 280px; box-shadow: 0 10px 50px rgba(0,0,0,0.7);
        }
        #monitor {
            position: absolute; bottom: 20px; right: 20px; width: 220px;
            z-index: 10; border-radius: 16px; border: 1px solid rgba(0,242,255,0.3);
            transform: scaleX(-1); background: #111;
        }
        .btn {
            background: #00f2ff; border: none; color: #000;
            padding: 12px; border-radius: 12px; width: 100%; margin-top: 15px;
            cursor: pointer; font-weight: 800; transition: 0.2s; text-transform: uppercase;
        }
        .btn:active { transform: scale(0.95); }
        #status-light { display: inline-block; width: 10px; height: 10px; background: red; border-radius: 50%; margin-right: 5px; }
    </style>
</head>
<body>

<div id="gui">
    <div style="font-size: 10px; opacity: 0.5; letter-spacing: 2px;">SPATIAL ENGINE V7.0</div>
    <div style="margin: 10px 0; font-size: 22px; font-weight: 900;">
        <span id="status-light"></span> <span id="status-text">DISCONNECTED</span>
    </div>
    <div style="font-size: 13px; color: #fff; opacity: 0.8; line-height: 1.4;">
        1. Click <b>START ENGINE</b> below.<br>
        2. Allow Camera access.<br>
        3. ü§è <b>Pinch</b> to write (Zero Lag).
    </div>
    
    <button class="btn" id="startBtn" onclick="startSystem()">üöÄ START ENGINE</button>
    <button class="btn" onclick="location.reload()" style="background:rgba(255,255,255,0.1); color:white;">üîÑ RESET</button>
</div>

<video id="input_video" playsinline style="display:none"></video>
<video id="monitor" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script>
    const video = document.getElementById('input_video');
    const monitor = document.getElementById('monitor');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { desynchronized: true });
    const statusText = document.getElementById('status-text');
    const statusLight = document.getElementById('status-light');
    
    let isDrawing = false;
    let lastX = 0, lastY = 0;

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        ctx.fillStyle = "black"; ctx.fillRect(0,0,canvas.width,canvas.height);
    }
    window.onresize = resize; resize();

    const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({ maxNumHands: 1, modelComplexity: 0, minDetectionConfidence: 0.8, minTrackingConfidence: 0.8 });

    hands.onResults((results) => {
        statusText.innerText = "SYSTEM LIVE";
        statusLight.style.background = "#0f0";
        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
            const marks = results.multiHandLandmarks[0];
            const tip = marks[8], thumb = marks[4];
            const x = (1 - tip.x) * canvas.width, y = tip.y * canvas.height;
            const dist = Math.hypot(tip.x - thumb.x, tip.y - thumb.y);

            if (dist > 0.25) { ctx.fillRect(0,0,canvas.width,canvas.height); }
            if (dist < 0.045) {
                ctx.strokeStyle = "#00f2ff"; ctx.lineWidth = 6; ctx.lineCap = "round";
                ctx.beginPath(); ctx.moveTo(isDrawing ? lastX : x, isDrawing ? lastY : y);
                ctx.lineTo(x, y); ctx.stroke();
                isDrawing = true;
            } else { isDrawing = false; }
            lastX = x; lastY = y;
        }
    });

    async function startSystem() {
        try {
            document.getElementById('startBtn').style.display = 'none';
            statusText.innerText = "REQUESTING CAMERA...";
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { width: 1280, height: 720, frameRate: 60 }
            });
            video.srcObject = stream; 
            monitor.srcObject = stream;
            
            const camera = new Camera(video, {
                onFrame: async () => { await hands.send({image: video}); },
                width: 1280, height: 720
            });
            camera.start();
        } catch (e) {
            statusText.innerText = "CAMERA ERROR";
            alert("Please allow camera access in your browser settings!");
        }
    }
</script>
</body>
</html>
